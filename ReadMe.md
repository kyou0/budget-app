# 💰 動的家計簿システム 要件定義書

## 📋 プロジェクト概要

### 目的
個人事業主向けの滞納防止重視型家計簿アプリ

### 主要ユーザー
- 個人で利用しつつ、収入先が複数ある方
	- 収入源：5社（契約単価変動あり）
- 例）管理項目：銀行8行、クレカ10枚、固定費8項目、変動費2項目、税金複数

---

## 💸 借金管理システム（重要機能）

### 背景・課題
- **個人事業主の現実**: 収入変動で支払い滞納リスク
- **緊急借入の必要性**: 滞納回避のための一時借入
- **支払い遅延の日常化**: 予定日に払えず後日支払い
- **モチベーション維持**: 借金完済への希望が見えない

### 解決する機能

#### 1. 借入先マスター管理
```
主要借入先の例:
- アコム（年18%、限度額50万、現在残高23万）
- プロミス（年17.8%、限度額30万、現在残高0万）
- 楽天カード（年18%、限度額100万、現在残高45万）
- 三井住友カード（年15%、限度額80万、現在残高12万）
- 親（年0%、限度額応相談、現在残高10万）
- 友人A（年0%、限度額5万、現在残高0万）
```

#### 2. 緊急借入シミュレーション
```
状況: 今月8万円不足
AI提案:
1. 親から借入（利息0円） → 影響: 完済2ヶ月延長
2. プロミス借入（利息年17.8%） → 影響: 完済4ヶ月延長
3. 楽天カード（利息年18%） → 影響: 完済5ヶ月延長

推奨: 親からの借入（総コスト最小）
```

#### 3. 支払い遅延管理
```
例: クレジットカード支払い
予定: 6/27 楽天カード -47,399円
実際: 支払い不可
処理: 
→ 6/27の予定を「延期」マーク
→ 7/10に新しい支払い予定作成
→ 遅延損害金1,200円を自動計算・追加
→ カレンダーに反映
```

#### 4. 借金完済シミュレーション
```
📊 現在の状況
総借入: ¥1,234,567
- 奨学金: ¥3,632,427（月20,295円、15年残）
- アコム: ¥234,567（月15,000円）
- 楽天カード: ¥450,000（月12,000円）
- 親: ¥100,000（月5,000円、利息なし）

月間返済合計: ¥52,295
完済予定: 2040年3月（あと15年4ヶ月）

💡 改善シミュレーション
月+5,000円なら: 2038年8月（1年7ヶ月短縮）
月+10,000円なら: 2037年1月（3年2ヶ月短縮）
月+20,000円なら: 2034年5月（5年10ヶ月短縮）

🎯 具体的目標
今年末までに: アコム完済（あと234,567円）
来年末までに: 楽天カード完済
```

#### 5. モチベーション維持機能
```
🎉 今月の成果
✅ 総借金が47,399円減りました！
✅ 完済予定が2ヶ月短縮されました！
✅ 利息負担を3,200円削減！

📈 進捗表示
借金減額率: 4.2%（順調なペース）
年間目標達成率: 67%（目標より早い！）
奨学金残り: 94.2%

🏆 マイルストーン
□ 消費者金融完済（あと6ヶ月）
□ クレジットカード完済（あと1年2ヶ月）  
□ 奨学金半額到達（あと7年）
□ 完全無借金（あと15年）
```

#### 6. 緊急対応ボタン
```
ダッシュボードに常設:
[💸 緊急借入] [📅 支払い延期] [✅ 支払い完了] [🔄 返済計画見直し]

💸 緊急借入フロー:
1. 必要金額入力
2. AI が最適借入先提案
3. 影響シミュレーション表示
4. 実行で自動的に収入・支出に反映

📅 支払い延期フロー:
1. 延期したい支払いを選択
2. 新しい支払い予定日を設定
3. 遅延損害金を自動計算
4. カレンダー・残高計算を更新
```

### 技術仕様

#### データ構造
```json
{
  "loans": [
    {
      "id": "loan001",
      "name": "アコム",
      "type": "消費者金融",
      "interestRate": 18.0,
      "maxLimit": 500000,
      "currentBalance": 234567,
      "monthlyPayment": 15000,
      "startDate": "2024-01-15",
      "isActive": true
    }
  ],
  "transactions": [
    {
      "id": "trans001", 
      "originalDate": "2025-06-27",
      "actualDate": "2025-07-10",
      "amount": -47399,
      "status": "delayed",
      "penaltyFee": 1200
    }
  ]
}
```

#### 計算アルゴリズム
- **複利計算**: 借入金利の正確な計算
- **返済シミュレーション**: 元利均等・元金均等両対応
- **最適化提案**: 総支払利息最小化の借入順序
- **遅延損害金**: 日割り計算

---

## 🎯 優先順位（1=最重要）

1. **見た目・使いやすさ**（毎日チェックしやすいUI）
2. **滞納防止**（今週の支払いスケジュール管理）
3. **月次作業の自動化**（ボタン1つで翌月生成）
4. **カード/口座追加の簡単さ**（マスター更新で反映）
5. **収支予測・残高管理**（あれば嬉しい程度）

---

## 🏗️ システム構成

### 3ページ構成
1. **📊 ダッシュボード**（メイン画面）
2. **⚙️ マスター管理**（データ登録・編集）
3. **🔧 設定**（Google連携・同期）

### 技術スタック
- **フロントエンド**: HTML + CSS + JavaScript
- **認証**: Google OAuth 2.0
- **データ同期**: Google Drive API
- **カレンダー連携**: Google Calendar API
- **ホスティング**: GitHub Pages
- **データ保存**: localStorage + Google Drive

---

## 🔐 セキュリティ要件

### 認証システム
- **ログイン前**: 金額などの詳細情報は非表示
- **ログイン後**: 全機能利用可能
- **認証方法**: Googleアカウント統一ログイン

### データ保護
- **ローカル暗号化**: ブラウザ保存時
- **クラウド保護**: Google Drive API経由
- **プライベート**: 個人アカウント内でのみアクセス可能

---

## 📊 機能要件

### 1. ダッシュボード機能

#### カレンダー表示
- **月間カレンダー形式**で支払いスケジュール表示
- **日付ごとの支払い項目**配置
- **色分け**: 収入(緑)、支出(赤)、今日(ハイライト)、延期(オレンジ)
- **アイコン表示**: 💳カード、🏠固定費、💰収入、🏛️税金、💸借入、📅延期
- **今週分強調表示**

#### 滞納防止機能
- **今日支払い**: 赤色ハイライト + アニメーション
- **今週支払い**: 黄色ハイライト
- **延滞項目**: 赤色 + 点滅アラート
- **延期項目**: オレンジ色表示
- **滞納チェックボタン**: ワンクリックリスク確認

#### サマリー表示
- **今月収入予定**
- **今月支出予定**
- **月末予想残高**
- **今週の支払い**
- **総借入残高**
- **月間返済額**
- **完済予定日**

#### 借金管理ダッシュボード
```
📊 借金の現状
総借入額: ¥1,234,567
月間返済額: ¥45,000
完済予定: 2027年3月（あと2年4ヶ月）

📈 返済シミュレーション  
このペースなら: 2027年3月完済
月+1万なら: 2026年8月完済（8ヶ月短縮！）
月+2万なら: 2026年1月完済（1年2ヶ月短縮！）

🎉 今月の進捗
✅ 借金が12万円減りました！
✅ 完済まで3ヶ月短縮！
✅ 利息を2.1万円節約！

🎯 モチベーション表示
完済まで: あと28ヶ月
今年末までに: あと15万円減らそう
目標達成率: 65% (順調です！)
```

### 2. マスター管理機能

#### 完全動的システム
- **項目追加**: マスター1行追加で全体反映
- **項目種別**: 銀行/カード/固定費/変動費/税金/収入/借入先
- **有効/無効管理**: 使わなくなった項目も履歴保持
- **契約変更対応**: 単価・支払日・支払先の履歴管理

#### 管理項目
```
- 銀行口座: 8行（変動対応）
- クレジットカード: 10枚（変動対応）
- 固定費: 8項目（家賃、奨学金等）
- 変動費: 2項目
- 税金: 複数（住民税、年金、国保、軽自動車税等）
- 収入: 5社（単価・契約変動対応）
- 借入先: 無制限（金利・限度額管理）
```

#### 借入先マスター管理
```json
{
  "name": "借入先名",
  "type": "loan",
  "interestRate": 18.0,
  "maxLimit": 500000,
  "currentBalance": 234567,
  "monthlyPayment": 15000,
  "isActive": true,
  "loanType": "消費者金融|銀行カードローン|親族|友人|クレジットカード"
}
```

#### 支払い遅延・調整機能
- **支払い延期**: 元の予定日から新しい日付へ移動
- **遅延損害金計算**: 日割り計算で自動算出
- **完了マーク**: 支払い完了時の処理
- **分割変更**: 支払い回数・金額の変更

#### 緊急借入機能
- **借入先選択**: 金利・限度額から最適提案
- **即座反映**: 借入実行で収入追加 + 翌月返済追加
- **影響計算**: 完済予定日への影響表示

### 3. 設定・同期機能

#### Google Drive 同期
- **自動バックアップ**: データ変更時に自動保存
- **マルチデバイス**: PC・スマホで完全同期
- **オフライン対応**: ローカル保存 + オンライン時同期

#### Google カレンダー連携
- **自動登録**: 支払日をカレンダーイベント化
- **通知設定**: 3日前・当日・延滞アラート
- **リマインダー**: スマホ通知で支払い忘れ防止

---

## 🎨 UI/UX要件

### デザイン原則
- **見やすさ最優先**: 毎日チェックしやすい
- **直感的操作**: エンジニアでも迷わない設計
- **レスポンシブ**: PC・スマホ・タブレット対応
- **PWA対応**: スマホホーム画面追加可能

### 色分けルール
- **収入**: 緑系
- **支出**: 赤系  
- **今日**: ハイライト
- **今週**: 黄色系
- **延滞**: 赤色点滅

### アイコン活用
- 🏦 銀行、💳 カード、🏠 固定費、🛒 変動費
- 🏛️ 税金、💰 収入、⚠️ アラート

---

## 🔄 自動化要件

### 月次処理
- **翌月生成**: ボタン1つで翌月データ作成
- **マスター継承**: 有効項目の自動引き継ぎ
- **日付自動生成**: 支払日の自動計算

### 滞納リスク判定
- **支払日基準**: 当日・今週・延滞の自動判定
- **残高予測**: 口座残高不足の事前警告（将来実装）
- **手動マーク**: 支払い完了の手動更新

### 収入管理
- **契約ベース**: 単価×稼働予定で自動計算
- **クライアント変動**: 契約終了・新規対応
- **予実管理**: 予定vs実績の差分表示

---

## 📱 マルチデバイス対応

### アクセス方法
- **PC**: ブラウザでURL直接アクセス
- **スマホ**: PWA化でアプリ風使用
- **URL**: https://kyou0.github.io/budget-app/

### データ同期
- **リアルタイム**: PC入力→スマホ即反映
- **双方向**: どちらからでも編集可能
- **競合回避**: 最終更新優先

---

## 💾 データ管理

### 保存形式
```json
{
  "masterData": [
    {
      "name": "項目名",
      "type": "bank|card|fixed|variable|tax|income", 
      "paymentDay": 1-31,
      "amount": 金額(収入は正数、支出は負数),
      "paymentMethod": "支払先",
      "isActive": true|false
    }
  ],
  "currentDate": {
    "year": 2025,
    "month": 7
  }
}
```

### バックアップ
- **自動**: Google Drive API
- **手動**: エクスポート/インポート機能
- **履歴**: 変更履歴の保持

---

## 🚀 実装フェーズ

### Phase 1: 基盤構築
1. 3ページ構成の基本レイアウト
2. ローカルデータ管理機能
3. 基本的なCRUD操作

### Phase 2: Google連携
1. Google OAuth認証
2. Google Drive API統合
3. データ同期機能

### Phase 3: カレンダー機能
1. 月間カレンダー表示
2. Google Calendar API連携
3. 通知・リマインダー機能

### Phase 4: 最適化
1. PWA対応
2. オフライン機能
3. パフォーマンス最適化

---

## 🔧 技術詳細

### API利用
- **Google Drive API**: データ保存・同期
- **Google Calendar API**: 支払日管理・通知
- **Google OAuth 2.0**: 認証・ログイン

### セキュリティ
- **HTTPS必須**: GitHub Pages標準対応
- **API Key管理**: 環境変数での管理
- **データ暗号化**: ローカル保存時の暗号化

---

## ✅ 成功指標

### 機能面
- [ ] 滞納が0になる
- [ ] 月次作業が5分以内
- [ ] 新規項目追加が1分以内
- [ ] マルチデバイス完全同期

### UX面  
- [ ] 毎日見る習慣の定着
- [ ] 直感的操作の実現
- [ ] ストレスフリーな入力

---

## 🆘 サポート・拡張

### 将来の機能追加
- AI要件定義で機能拡張
- 新しいAPI連携
- 分析・レポート機能
- 複数人共有機能

### メンテナンス
- GitHubでのバージョン管理
- 段階的な機能改善
- ユーザーフィードバック反映

---

**📞 Contact**: ChatGPTで要件定義 → 即座に実装対応