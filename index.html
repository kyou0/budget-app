<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>💰 家計簿アプリ v2.0 - ダッシュボード</title>
    <!-- PWA対応 -->
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#667eea">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="家計簿アプリ">

    <style>
        /* --- 基本スタイル --- */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        /* --- ログイン画面 --- */
        .login-screen { display: flex; justify-content: center; align-items: center; min-height: 100vh; padding: 20px; }
        .login-card { background: rgba(255, 255, 255, 0.95); padding: 40px; border-radius: 20px; text-align: center; box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3); backdrop-filter: blur(10px); max-width: 400px; width: 100%; }
        .login-card h1 { color: #2c3e50; margin-bottom: 10px; font-size: 2.5em; }
        .login-card p { color: #6c757d; margin-bottom: 30px; font-size: 1.1em; }
        .google-login-btn, .local-login-btn { background: #4285f4; color: white; border: none; padding: 15px 30px; border-radius: 10px; font-size: 1.1em; font-weight: 600; cursor: pointer; width: 100%; transition: all 0.3s ease; box-shadow: 0 4px 15px rgba(66, 133, 244, 0.3); margin-bottom: 15px; }
        .local-login-btn { background: #28a745; box-shadow: 0 4px 15px rgba(40, 167, 69, 0.3); }
        .google-login-btn:hover { background: #3367d6; transform: translateY(-2px); box-shadow: 0 6px 20px rgba(66, 133, 244, 0.4); }
        .local-login-btn:hover { background: #218838; transform: translateY(-2px); box-shadow: 0 6px 20px rgba(40, 167, 69, 0.4); }

        /* --- メインアプリ --- */
        .app-container { display: none; max-width: 1400px; margin: 0 auto; padding: 20px; }
        .header { background: rgba(255, 255, 255, 0.95); border-radius: 15px; padding: 20px; margin-bottom: 20px; box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1); backdrop-filter: blur(10px); }
        .header-top { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; flex-wrap: wrap; gap: 10px; }
        .header h1 { color: #2c3e50; font-size: 2em; }
        .user-info { display: flex; align-items: center; gap: 10px; }
        .logout-btn { background: #dc3545; color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-weight: 600; }
        .navigation { display: flex; gap: 10px; flex-wrap: wrap; }
        .nav-btn { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; padding: 12px 24px; border-radius: 8px; cursor: pointer; font-weight: 600; transition: all 0.3s ease; text-decoration: none; display: inline-block; }
        .nav-btn.active { background: linear-gradient(135deg, #28a745 0%, #20c997 100%); }
        .nav-btn:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3); }
        .controls { display: flex; gap: 15px; align-items: center; flex-wrap: wrap; margin-top: 15px; }
        .month-selector { display: flex; align-items: center; gap: 10px; }
        .btn { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer; font-weight: 600; transition: all 0.3s ease; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2); }
        .btn:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3); }
        .current-month { font-size: 1.2em; font-weight: bold; color: #2c3e50; min-width: 120px; text-align: center; }

        /* --- 通知 --- */
        .sync-notification { position: fixed; top: 20px; right: 20px; background: linear-gradient(135deg, #28a745 0%, #20c997 100%); color: white; padding: 15px 20px; border-radius: 10px; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2); z-index: 1000; font-weight: 600; animation: slideIn 0.3s ease; }
        .sync-notification.warning { background: linear-gradient(135deg, #ffa726 0%, #fb8c00 100%); }
        .sync-notification.info { background: linear-gradient(135deg, #4285f4 0%, #3367d6 100%); }
        .sync-notification.error { background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%); }
        @keyframes slideIn { from { transform: translateX(100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }

        /* --- サマリーカード --- */
        .summary-cards { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 15px; margin-bottom: 20px; }
        .summary-card { background: rgba(255, 255, 255, 0.9); padding: 20px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1); }
        .summary-card h3 { font-size: 0.9em; margin-bottom: 10px; color: #6c757d; display: flex; align-items: center; gap: 8px; }
        .summary-card .amount { font-size: 1.8em; font-weight: bold; color: #2c3e50; }
        .summary-card .amount.income { color: #28a745; }
        .summary-card .amount.expense { color: #dc3545; }
        .summary-card .sub-text { font-size: 0.8em; color: #6c757d; margin-top: 5px; height: 1.2em; }

        /* --- カレンダー --- */
        .calendar-container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
        }
        .calendar-header {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 1.3em;
            border-bottom: 2px solid #667eea;
            padding-bottom: 5px;
        }
        .calendar {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 2px;
            background: #e9ecef;
            border-radius: 10px;
            overflow: hidden;
        }
        .calendar-day-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 10px;
            text-align: center;
            font-weight: 600;
        }
        .calendar-day {
            background: white;
            min-height: 120px;
            padding: 8px;
            position: relative;
            border: 1px solid #e9ecef;
            display: flex;
            flex-direction: column;
            gap: 3px;
        }
        .calendar-day.other-month {
            background: #f8f9fa;
            opacity: 0.5;
        }
        .calendar-day.today {
            background: #fff3cd;
            border: 2px solid #ffc107;
        }
        .day-number {
            font-weight: bold;
            margin-bottom: 5px;
            color: #2c3e50;
        }
        .calendar-item {
            color: white;
            padding: 3px 6px;
            border-radius: 4px;
            font-size: 0.8em;
            margin-bottom: 2px;
            cursor: pointer;
            transition: transform 0.2s ease;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        .calendar-item:hover {
            transform: scale(1.05);
        }
        .calendar-item.income { background: #28a745; }
        .calendar-item.expense { background: #dc3545; }
        .calendar-item.loan { background: #ffc107; color: #000; }
        .calendar-item.overdue {
            border: 2px dashed #dc3545;
            animation: blink 1.5s infinite;
        }
        @keyframes blink { 50% { opacity: 0.5; } }

        /* --- レスポンシブ --- */
        @media (max-width: 768px) {
            .controls, .navigation {
                flex-direction: column;
                align-items: stretch;
            }
            .calendar { font-size: 0.8em; }
            .calendar-day { min-height: 80px; }
        }
    </style>

    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <script src="https://unpkg.com/jwt-decode/build/jwt-decode.js"></script>
</head>
<body>
<!-- ログイン画面 -->
<div id="loginScreen" class="login-screen">
    <div class="login-card">
        <h1>💰 家計簿アプリ</h1>
        <p>滞納防止・借金管理に特化した<br>あなた専用の家計簿システム</p>
        <button class="google-login-btn" onclick="tryGoogleLogin()">🔐 Googleでログイン</button>
        <button class="local-login-btn" onclick="localLogin()">📱 ローカルモードで開始</button>
    </div>
</div>

<!-- メインアプリ -->
<div id="appContainer" class="app-container">
    <div class="header">
        <div class="header-top">
            <h1>💰 ダッシュボード</h1>
            <div class="user-info">
                <span id="userName">ユーザー</span>
                <button class="logout-btn" onclick="logout()">ログアウト</button>
            </div>
        </div>
        <div class="navigation">
            <button class="nav-btn active">📊 ダッシュボード</button>
            <button class="nav-btn" onclick="goToMasterManagement()">⚙️ マスター管理</button>
            <button class="nav-btn" onclick="goToSettings()">🔧 設定</button>
        </div>
        <div class="controls">
            <div class="month-selector">
                <button class="btn" onclick="changeMonth(-1)">◀ 前月</button>
                <div class="current-month" id="currentMonth">2025年7月</div>
                <button class="btn" onclick="changeMonth(1)">次月 ▶</button>
            </div>
            <button class="btn" onclick="checkOverdueRisk()">⚠️ 滞納チェック</button>
        </div>
    </div>

    <!-- サマリーカード -->
    <div class="summary-cards">
        <div class="summary-card">
            <h3>💰 今月収入予定</h3>
            <div class="amount income" id="summaryIncome">¥0</div>
        </div>
        <div class="summary-card">
            <h3>💸 今月支出予定</h3>
            <div class="amount expense" id="summaryExpense">¥0</div>
        </div>
        <div class="summary-card">
            <h3>⚖️ 月末予想残高</h3>
            <div class="amount" id="summaryBalance">¥0</div>
        </div>
        <div class="summary-card">
            <h3>🗓️ 今週の支払い</h3>
            <div class="amount expense" id="summaryWeekly">¥0</div>
        </div>
        <div class="summary-card">
            <h3>🏦 総借入残高</h3>
            <div class="amount expense" id="summaryTotalDebt">¥0</div>
        </div>
        <div class="summary-card">
            <h3>💳 月間返済額</h3>
            <div class="amount" id="summaryMonthlyRepayment">¥0</div>
        </div>
        <div class="summary-card">
            <h3>🏁 完済予定</h3>
            <div class="amount" id="summaryCompletionDate">--</div>
            <div class="sub-text" id="summaryCompletionSubtext"></div>
        </div>
    </div>

    <!-- カレンダー -->
    <div class="calendar-container">
        <h2 class="calendar-header">📅 今月の支払いカレンダー</h2>
        <div class="calendar" id="calendar"></div>
    </div>
</div>

<script>
  // ===================================================================================
  // グローバル変数
  // ===================================================================================
  const GOOGLE_CLIENT_ID = '138150284146-07ul0ennhq22tm0ih3hngv8pnjsgo1u3.apps.googleusercontent.com';
  let masterData = [];
  let currentUser = null;
  let loginMode = 'local';
  let currentYear = new Date().getFullYear();
  let currentMonth = new Date().getMonth() + 1;

  // ===================================================================================
  // 初期化処理
  // ===================================================================================
  document.addEventListener('DOMContentLoaded', function() {
    console.log('🚀 家計簿アプリ v2.0 起動');

    // Googleログインの初期化
    try {
      google.accounts.id.initialize({
        client_id: GOOGLE_CLIENT_ID,
        callback: handleGoogleLoginSuccess // ログイン成功時に呼ばれる関数
      });
    } catch (e) {
      console.error("Google Sign-Inの初期化に失敗しました。ライブラリが読み込まれていないか、クライアントIDが不正です。", e);
    }

    // ログイン状態を復元しようと試みる
    const savedUserJSON = localStorage.getItem('budgetAppUser');
    if (savedUserJSON && savedUserJSON !== 'undefined' && savedUserJSON !== 'null') {
      try {
        const user = JSON.parse(savedUserJSON);
        if (user && typeof user === 'object' && user.name && user.mode) {
          currentUser = user;
          loginMode = user.mode;
          showApp();
          return;
        } else {
          console.warn('保存されていたユーザーデータが不正な形式です。');
          localStorage.removeItem('budgetAppUser');
        }
      } catch (e) {
        console.error("ユーザーデータの解析に失敗しました:", e);
        localStorage.removeItem('budgetAppUser');
      }
    }
  });

  function showApp() {
    document.getElementById('loginScreen').style.display = 'none';
    document.getElementById('appContainer').style.display = 'block';
    document.getElementById('userName').textContent = currentUser.name;
    initializeApp();
  }

  function initializeApp() {
    loadData();
    renderAll();
    showNotification(`✅ ${currentUser.name}としてログインしました`);
  }

  function renderAll() {
    updateCurrentMonthDisplay();
    generateCalendar();
    updateSummaryCards();
  }

  // ===================================================================================
  // 認証 & ユーザー管理
  // ===================================================================================
  /**
   * Googleログインのプロンプトを表示する
   */
  function tryGoogleLogin() {
    try {
      // Googleのログインプロンプトを表示
      google.accounts.id.prompt();
    } catch (e) {
      console.error("Googleログインのプロンプト表示に失敗しました。", e);
      showNotification('Googleログインの準備ができていません。ページをリロードしてみてください。', 'error');
    }
  }

  /**
   * Googleログイン成功時に呼び出されるコールバック関数
   * @param {object} response - Googleからの認証情報
   */
  function handleGoogleLoginSuccess(response) {
    console.log("Googleから認証情報を受け取りました:", response);
    // jwt-decodeライブラリを使って、認証情報(JWT)からユーザー情報を抜き出す
    const userObject = jwt_decode(response.credential);

    currentUser = {
      name: userObject.name,
      email: userObject.email,
      mode: 'google'
    };
    loginMode = 'google';

    localStorage.setItem('budgetAppUser', JSON.stringify(currentUser));
    showApp();
  }

  function localLogin() {
    currentUser = { name: 'ローカルユーザー', mode: 'local' };
    loginMode = 'local';
    localStorage.setItem('budgetAppUser', JSON.stringify(currentUser));
    showApp();
  }

  function logout() {
    // Googleからもサインアウトする
    if (loginMode === 'google' && typeof google !== 'undefined') {
      google.accounts.id.disableAutoSelect();
    }
    currentUser = null;
    localStorage.removeItem('budgetAppUser');
    // 画面をリロードしてログイン画面に戻すのが一番確実
    window.location.reload();
  }

  // ===================================================================================
  // データ管理
  // ===================================================================================
  function loadData() {
    try {
      const savedMaster = localStorage.getItem('budgetMasterData');
      if (savedMaster && savedMaster !== 'undefined' && JSON.parse(savedMaster).length > 0) {
        masterData = JSON.parse(savedMaster);
        console.log('📂 保存されたマスターデータを読み込みました。');
      } else {
        loadSampleData();
        localStorage.setItem('budgetMasterData', JSON.stringify(masterData));
      }
    } catch (e) {
      console.error("マスターデータの解析に失敗しました。サンプルデータで初期化します。", e);
      localStorage.removeItem('budgetMasterData'); // 不正なデータを削除
      loadSampleData();
      localStorage.setItem('budgetMasterData', JSON.stringify(masterData));
    }
  }

  function loadSampleData() {
    masterData = [
      { id: 'item_1', name: "クライアントA", type: "income", paymentDay: 10, amount: 200000, paymentMethod: "銀行振込", isActive: true },
      { id: 'item_3', name: "家賃", type: "fixed", paymentDay: 27, amount: -80000, paymentMethod: "銀行振込", isActive: true },
      { id: 'item_5', name: "メインカード", type: "card", paymentDay: 4, amount: -50000, paymentMethod: "メイン銀行", isActive: true },
      { id: 'item_8', name: "アコム", type: "loan", paymentDay: 27, amount: -15000, paymentMethod: "メイン銀行", isActive: true, loanDetails: { loanType: "消費者金融", interestRate: 18.0, maxLimit: 500000, currentBalance: 234567 } },
      { id: 'item_9', name: "楽天カードローン", type: "loan", paymentDay: 12, amount: -12000, paymentMethod: "楽天銀行", isActive: true, loanDetails: { loanType: "クレジットカード", interestRate: 15.0, maxLimit: 1000000, currentBalance: 450000 } }
    ];
    showNotification('📋 サンプルデータを読み込みました。', 'info');
  }

  // ===================================================================================
  // UI描画 & 更新
  // ===================================================================================
  function changeMonth(delta) {
    currentMonth += delta;
    if (currentMonth > 12) {
      currentMonth = 1;
      currentYear++;
    } else if (currentMonth < 1) {
      currentMonth = 12;
      currentYear--;
    }
    renderAll();
  }

  function updateCurrentMonthDisplay() {
    document.getElementById('currentMonth').textContent = `${currentYear}年${currentMonth}月`;
  }

  function generateCalendar() {
    const calendar = document.getElementById('calendar');
    calendar.innerHTML = '';
    const weekdays = ['日', '月', '火', '水', '木', '金', '土'];
    weekdays.forEach(day => {
      const header = document.createElement('div');
      header.className = 'calendar-day-header';
      header.textContent = day;
      calendar.appendChild(header);
    });

    const firstDayOfMonth = new Date(currentYear, currentMonth - 1, 1);
    const startingDay = firstDayOfMonth.getDay();
    const daysInMonth = new Date(currentYear, currentMonth, 0).getDate();

    for (let i = 0; i < startingDay; i++) {
      calendar.insertAdjacentHTML('beforeend', '<div class="calendar-day other-month"></div>');
    }

    for (let day = 1; day <= daysInMonth; day++) {
      const dayElement = document.createElement('div');
      dayElement.className = 'calendar-day';
      const today = new Date();
      if (currentYear === today.getFullYear() && currentMonth === today.getMonth() + 1 && day === today.getDate()) {
        dayElement.classList.add('today');
      }
      dayElement.innerHTML = `<div class="day-number">${day}</div>`;

      const itemsForDay = masterData.filter(item => item.isActive && item.paymentDay === day);
      itemsForDay.forEach(item => {
        const itemElement = document.createElement('div');
        itemElement.className = 'calendar-item';
        const icon = { income: '💰', expense: '💸', loan: '🏦', card: '💳', fixed: '🏠', tax: '🏛️', bank: '🏦', variable: '🛒' }[item.type] || '📄';
        itemElement.innerHTML = `${icon} ${item.name}`;
        itemElement.title = `${item.name}: ${item.amount.toLocaleString()}円`;
        if (item.amount > 0) itemElement.classList.add('income');
        else if (item.type === 'loan') itemElement.classList.add('loan');
        else itemElement.classList.add('expense');
        dayElement.appendChild(itemElement);
      });
      calendar.appendChild(dayElement);
    }
  }

  function updateSummaryCards() {
    const activeItems = masterData.filter(item => item.isActive);
    const income = activeItems.filter(i => i.amount > 0).reduce((sum, i) => sum + i.amount, 0);
    const expense = activeItems.filter(i => i.amount < 0).reduce((sum, i) => sum + i.amount, 0);

    const today = new Date();
    const weekEnd = new Date(today.getFullYear(), today.getMonth(), today.getDate() + 7);
    const weeklyExpense = activeItems.filter(i => {
      if (i.amount >= 0 || !i.paymentDay) return false;
      const paymentDateThisMonth = new Date(currentYear, currentMonth - 1, i.paymentDay);
      return paymentDateThisMonth >= today && paymentDateThisMonth < weekEnd;
    }).reduce((sum, i) => sum + i.amount, 0);

    const loanItems = activeItems.filter(i => i.type === 'loan');
    const totalDebt = loanItems.reduce((sum, i) => sum + (i.loanDetails?.currentBalance || 0), 0);
    const monthlyRepayment = loanItems.reduce((sum, i) => sum + Math.abs(i.amount), 0);

    document.getElementById('summaryIncome').textContent = `¥${income.toLocaleString()}`;
    document.getElementById('summaryExpense').textContent = `¥${Math.abs(expense).toLocaleString()}`;
    document.getElementById('summaryBalance').textContent = `¥${(income + expense).toLocaleString()}`;
    document.getElementById('summaryWeekly').textContent = `¥${Math.abs(weeklyExpense).toLocaleString()}`;
    document.getElementById('summaryTotalDebt').textContent = `¥${totalDebt.toLocaleString()}`;
    document.getElementById('summaryMonthlyRepayment').textContent = `¥${monthlyRepayment.toLocaleString()}`;

    // 完済予定日の計算
    const { years, months } = calculateCompletionDate(loanItems);
    if (years > 0 || months > 0) {
      let completionText = '';
      if (years > 0) completionText += `${years}年`;
      if (months > 0) completionText += `${months}ヶ月`;
      completionText += '後';

      document.getElementById('summaryCompletionDate').textContent = completionText;
      const completionDate = new Date();
      completionDate.setMonth(completionDate.getMonth() + (years * 12 + months));
      document.getElementById('summaryCompletionSubtext').textContent = `( ${completionDate.getFullYear()}年${completionDate.getMonth() + 1}月頃 )`;
    } else if (loanItems.length > 0 && monthlyRepayment > 0) {
      document.getElementById('summaryCompletionDate').textContent = "計算不可";
      document.getElementById('summaryCompletionSubtext').textContent = "返済額が利息を下回っています";
    } else {
      document.getElementById('summaryCompletionDate').textContent = "借入なし";
      document.getElementById('summaryCompletionSubtext').textContent = "";
    }
  }

  function calculateCompletionDate(loanItems) {
    if (loanItems.length === 0) return { years: 0, months: 0 };
    let maxMonths = 0;
    loanItems.forEach(loan => {
      const balance = loan.loanDetails?.currentBalance || 0;
      const monthlyPayment = Math.abs(loan.amount) || 0;
      const annualRate = loan.loanDetails?.interestRate || 0;
      if (balance <= 0 || monthlyPayment <= 0) return;
      if (annualRate === 0) {
        const months = Math.ceil(balance / monthlyPayment);
        if (months > maxMonths) maxMonths = months;
        return;
      }
      const monthlyRate = annualRate / 100 / 12;
      const minPayment = balance * monthlyRate;
      if (monthlyPayment <= minPayment) {
        maxMonths = Infinity;
        return;
      }
      const num = -Math.log(1 - (balance * monthlyRate) / monthlyPayment);
      const den = Math.log(1 + monthlyRate);
      const months = Math.ceil(num / den);
      if (months > maxMonths) maxMonths = months;
    });
    if (maxMonths === Infinity || !isFinite(maxMonths)) return { years: 0, months: 0 };
    const years = Math.floor(maxMonths / 12);
    const months = maxMonths % 12;
    return { years, months };
  }

  // ===================================================================================
  // 機能 & ページ遷移
  // ===================================================================================
  function checkOverdueRisk() {
    const today = new Date();
    today.setHours(0, 0, 0, 0);
    const overdueItems = masterData.filter(item => {
      if (!item.isActive || item.amount >= 0 || !item.paymentDay) return false;
      const paymentDate = new Date(currentYear, currentMonth - 1, item.paymentDay);
      return paymentDate < today && paymentDate.getMonth() === currentMonth - 1;
    });
    if (overdueItems.length > 0) {
      let message = '⚠️ 以下の項目が支払期日を過ぎています！\n\n';
      overdueItems.forEach(item => {
        message += `• ${item.paymentDay}日: ${item.name} (${Math.abs(item.amount).toLocaleString()}円)\n`;
      });
      alert(message);
      showNotification('⚠️ 滞納リスクが発見されました', 'warning');
    } else {
      showNotification('✅ 現時点で滞納している項目はありません。');
    }
  }

  function goToMasterManagement() {
    window.location.href = 'master.html';
  }

  function goToSettings() {
    window.location.href = 'settings.html';
  }

  // ===================================================================================
  // ヘルパー関数
  // ===================================================================================
  function showNotification(message, type = 'success') {
    const existing = document.querySelector('.sync-notification');
    if (existing) existing.remove();
    const notification = document.createElement('div');
    notification.className = `sync-notification ${type}`;
    notification.textContent = message;
    document.body.appendChild(notification);
    setTimeout(() => {
      notification.style.animation = 'slideIn 0.3s ease reverse';
      setTimeout(() => notification.remove(), 300);
    }, 4000);
  }
</script>

</body>
</html>